<!DOCTYPE html>
<html>
<head>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.7.4/dist/vuetify.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/vuetify@3.7.4/dist/vuetify.min.js"></script>
    <title>My first Vue page</title>
    <style>
        #app {
            /* display: inline-block;
            padding: 10px; */
            font-size: x-large;
            background-color: lightgreen;
        }
    </style>
</head>
<body>
    <div id="app">
        <v-app>
            <div class="pa-4 bg-primary">แบบทดสอบ</div>
            <v-btn class="yellow darken-1 ma-2" @click="load_data('quiz1.json')">
                <v-icon>mdi-play-circle</v-icon> เริ่มทำแบบทดสอบ 1
            </v-btn>
            <v-btn class="yellow darken-1 ma-2" @click="load_data('quiz2.json')">
                <v-icon>mdi-play-circle</v-icon> เริ่มทำแบบทดสอบ 2
            </v-btn>

            <div v-if="page==2">
                <div v-for="(q, i) in qlist" :key="i" class="my-1 pa-4 border-info">
                    ข้อที่ {{ i+1 }} <br>
                    <div v-html="q.title" class="pa-2"></div>
                    <v-radio-group v-model="answers[i]">
                        <v-radio v-for="(otxt, ov) in q.options" :key="ov" :label="otxt" :value="ov+1" />
                    </v-radio-group>
                </div>
                <div class="position-sticky bottom-0 pa-4 bg-primary">
                    <v-btn v-if="validate()" @click="grading()">
                        <v-icon>mdi-check</v-icon> ตรวจคำตอบ
                    </v-btn>
                    <div v-else>กรุณาตอบให้ครบ</div>
                </div>
            </div>
            <div v-if="page==3">
                คุณได้คะแนน {{ score }}
            </div>
        </v-app>
    </div>

    <script>
        
        const { createApp } = Vue;
        const { createVuetify } = Vuetify;

        const vuetify = createVuetify();
        const app = createApp({
            data() {
                return {
                    message: "Hello",
                    qlist: [],
                    answers: [],
                    score: 0,
                    page: 1,
                };
            },
            mounted() {
                this.load_data(); // กำหนดไฟล์เริ่มต้น
            },
            methods: {
                async load_data(file) {
                    try {
                        const res = await fetch(file);
                        this.qlist = await res.json();
                        this.answers = new Array(this.qlist.length).fill(null); // เคลียร์คำตอบเก่า
                        this.page = 2; // ไปยังหน้าทำแบบทดสอบ
                    } catch (error) {
                        console.error("Error loading quiz data:", error);
                    }
                },

                validate() {//ฟังก์ชันนี้ตรวจสอบว่าผู้ใช้ตอบคำถามครบทุกข้อหรือยัง
                    return this.qlist.every((q, i) => !!this.answers[i]);
                    /*
                    every(callback): ตรวจสอบว่าเงื่อนไขใน callback เป็นจริง (true) สำหรับทุกค่าภายในอาร์เรย์
                    !!this.answers[i]: แปลงค่าที่ผู้ใช้เลือก (this.answers[i]) เป็น Boolean
                    */
                },

                // ฟังก์ชันนี้คำนวณคะแนนของผู้ใช้โดยเปรียบเทียบคำตอบที่ให้ (answers) กับคำตอบที่ถูกต้อง (qlist.answer) และสรุปคะแนนรวม
                grading() {
                    this.score = this.qlist.reduce(
                        (n, q, i) => n + (this.answers[i] == q.answer ? 1 : 0),
                        0
                    );
                    this.page = 3;
                },
                /*
                reduce() ในการวนลูปเพื่อนับคะแนนรวม   n: คะแนนสะสม  q: คำถามแต่ละข้อใน qlist  i: ดัชนีของคำถาม  initialValue: เริ่มต้นด้วยคะแนน 0
                this.answers[i] == q.answer ? 1 : 0:
                ตรวจสอบว่าคำตอบที่ผู้ใช้เลือก (this.answers[i]) ตรงกับคำตอบที่ถูกต้อง (q.answer) หรือไม่ หากตรงกัน จะคืนค่า 1 (เพิ่ม 1 คะแนน)
                หากไม่ตรง จะคืนค่า 0

                */
            },
        });

        app.use(vuetify).mount('#app');
    </script>
</body>
</html>
